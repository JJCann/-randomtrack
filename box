/*
 * Nightbot command:
 * !editcom -ul=everyone -cd=5 !box $(eval car('$(query)', $(urlfetch json https://docs.google.com/spreadsheets/d/13dBtO6p1NXLn1MnZS32oyvQNYWGyLoG1c9qy6U6KOa4/export?exportFormat=tsv)); $(urlfetch json https://raw.githubusercontent.com/JJCann/-randomtrack/master/box);)
*/
function car(query = '', data = {}) {
    query = normalize(query);

    /* Find all car that match the specified track type */
    const [carname] = parse_query(query);
    const cars = data[carname];
    if (cars !== Object(cars)) {
        return 'To use this command, write !randomcar, then a space, then the class you want (single, not plural - including all/meme), or a letter (A-Z)'
    }
 
    /* Output a random car (or error message) */
    if (cars.length > 0) {
        const i = Math.floor(Math.random() * cars.length);
        const car = cars[i];
        
        return car;
    }
    return 'Could not find one ¯\\_(ツ)_/¯';
}
